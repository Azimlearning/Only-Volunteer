# How to Verify AI Alerts are Working in Real-Time

This guide helps you verify that your alerts are actually being generated by AI in real-time, not just static data.

---

## üîç Verification Checklist

### ‚úÖ Step 1: Check if Function is Deployed

**Method A: Firebase Console**
1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select your project: `onlyvolunteer-e3066`
3. Navigate to **Functions** ‚Üí **Cloud Functions**
4. Look for `monitorNewsForAlerts`
5. ‚úÖ **Should show**: Status = "Active" or "Deployed"

**Method B: Firebase CLI**
```bash
firebase functions:list
```
‚úÖ **Should show**: `monitorNewsForAlerts` in the list

---

### ‚úÖ Step 2: Check Cloud Scheduler (The Trigger)

The function runs **every 15 minutes** via Cloud Scheduler.

**Method A: Google Cloud Console**
1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Select project: `onlyvolunteer-e3066`
3. Navigate to **Cloud Scheduler**
4. Look for job: `firebase-schedule-monitorNewsForAlerts-us-central1`
5. ‚úÖ **Should show**:
   - Status: **Enabled** (green toggle)
   - Schedule: `*/15 * * * *` (every 15 minutes)
   - Time zone: `Asia/Kuala_Lumpur`
   - Last run: Recent timestamp (within last hour)

**Method B: Check via Firebase CLI**
```bash
gcloud scheduler jobs list --project=onlyvolunteer-e3066
```

**If scheduler is missing or disabled:**
- The function won't run automatically
- You'll need to manually trigger it (see Step 5)

---

### ‚úÖ Step 3: Check Function Logs (Proof of Execution)

This is the **most important** step - it shows if AI is actually running.

**Method A: Firebase Console**
1. Go to Firebase Console ‚Üí **Functions**
2. Click on `monitorNewsForAlerts`
3. Go to **Logs** tab
4. ‚úÖ **Look for recent entries** (within last hour) showing:
   ```
   Fetching Malaysian news...
   Analyzing article: [article title]
   Alert created: [alert title]
   ```
5. ‚úÖ **Check for AI activity**: Look for logs mentioning:
   - "Analyzing article" (Gemini is processing)
   - "Alert created" (AI decided to create alert)
   - "Duplicate alert exists, skipping" (AI checked for duplicates)

**Method B: Google Cloud Console**
1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Navigate to **Cloud Functions** ‚Üí `monitorNewsForAlerts`
3. Click **Logs** tab
4. Filter by time: Last 1 hour
5. ‚úÖ **Should see**: Multiple log entries showing the function running

**Method C: Firebase CLI**
```bash
firebase functions:log --only monitorNewsForAlerts
```

**What to look for in logs:**
- ‚úÖ **Good signs**:
  - "Fetching Malaysian news"
  - "Analyzing article with Gemini"
  - "Alert created: [title]"
  - "No articles found" (means it's checking, just no news)
  
- ‚ùå **Bad signs**:
  - "NewsAPI key not configured"
  - "Gemini analysis error"
  - "Error fetching news"
  - No logs at all (function not running)

---

### ‚úÖ Step 4: Verify Alerts in Firestore (Check Timestamps)

**Method A: Firebase Console**
1. Go to Firebase Console ‚Üí **Firestore Database**
2. Navigate to `alerts` collection
3. ‚úÖ **Check `createdAt` timestamps**:
   - Should have alerts created within the last few hours
   - Timestamps should be recent (not old test data)
   - Multiple alerts with different timestamps = real-time generation

4. ‚úÖ **Check alert structure**:
   - Each alert should have:
     - `title`: Short alert title
     - `body`: Description
     - `type`: "flood", "sos", or "general"
     - `region`: Location name
     - `severity`: "high", "medium", or "low"
     - `createdAt`: Recent timestamp
     - `expiresAt`: 7 days from creation

**Method B: In Your App**
1. Open the Alerts screen (`/alerts`)
2. Check the timestamps shown on each alert
3. ‚úÖ **Should see**: Recent timestamps (within last few hours)
4. Refresh the page - if new alerts appear, it's working!

**Method C: Check Alert Patterns**
- ‚úÖ **Real AI alerts** will have:
  - Varied timestamps (not all same time)
  - Different regions (Kuala Lumpur, Selangor, Pahang, etc.)
  - Different types (flood, sos, general)
  - Natural language titles (not test data)
  
- ‚ùå **Test/static data** will have:
  - All same timestamp
  - Same region
  - Generic titles like "Test Alert"

---

### ‚úÖ Step 5: Manually Trigger Function (Test It Now)

**Method A: Google Cloud Console**
1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Navigate to **Cloud Scheduler**
3. Find `firebase-schedule-monitorNewsForAlerts-us-central1`
4. Click **Run Now** (three dots menu ‚Üí Run now)
5. ‚úÖ **Wait 30-60 seconds**
6. Check Firestore `alerts` collection for new alert
7. Check function logs to see execution

**Method B: Firebase CLI**
```bash
# Trigger via Pub/Sub
gcloud pubsub topics publish firebase-schedule-monitorNewsForAlerts-us-central1 --message='{"data":"test"}'
```

**Method C: Create Test Alert Manually**
```bash
# Using Firebase Console ‚Üí Firestore
# Add a test document to verify the UI works
```

---

### ‚úÖ Step 6: Verify AI is Actually Analyzing (Gemini Logs)

**Check Gemini API Usage:**
1. Go to [Google AI Studio](https://aistudio.google.com)
2. Check **API Usage** or **Quota** section
3. ‚úÖ **Should see**: Recent API calls (within last hour)
4. ‚úÖ **Should see**: Token usage increasing

**Check Function Logs for Gemini Activity:**
- Look for logs containing:
  - "Generating content with Gemini"
  - "Gemini analysis error" (if there's an issue)
  - JSON parsing logs (showing AI response)

---

### ‚úÖ Step 7: Verify NewsAPI is Working

**Check NewsAPI Quota:**
1. Go to [NewsAPI Dashboard](https://newsapi.org/account)
2. Check your API key usage
3. ‚úÖ **Should see**: Recent requests (within last hour)
4. ‚úÖ **Free tier**: 100 requests/day - check if you're hitting limit

**Test NewsAPI Directly:**
```bash
curl "https://newsapi.org/v2/everything?q=Malaysia+flood&language=en&sortBy=publishedAt&apiKey=YOUR_API_KEY"
```
‚úÖ **Should return**: JSON with recent Malaysian news articles

---

## üéØ Quick Verification Test (5 Minutes)

**Run this test to verify everything is working:**

1. **Check Scheduler Status** (1 min)
   - Google Cloud Console ‚Üí Cloud Scheduler
   - Verify job is **Enabled**

2. **Manually Trigger Function** (1 min)
   - Click "Run Now" on the scheduler job
   - Wait 30 seconds

3. **Check Logs** (1 min)
   - Firebase Console ‚Üí Functions ‚Üí Logs
   - Should see execution logs

4. **Check Firestore** (1 min)
   - Firebase Console ‚Üí Firestore ‚Üí `alerts`
   - Should see new alert with recent timestamp

5. **Check App** (1 min)
   - Open `/alerts` screen
   - Should see new alert appear

‚úÖ **If all 5 steps work**: Your AI alerts are legitimately running in real-time!

---

## üö® Common Issues & Solutions

### Issue: No logs appearing
**Solution:**
- Function might not be deployed: `firebase deploy --only functions:monitorNewsForAlerts`
- Scheduler might be disabled: Enable it in Cloud Scheduler
- Check function is actually scheduled (not just callable)

### Issue: "NewsAPI key not configured"
**Solution:**
```bash
firebase functions:config:set news.api_key="YOUR_NEWSAPI_KEY"
firebase deploy --only functions
```

### Issue: "Gemini analysis error"
**Solution:**
```bash
firebase functions:config:set gemini.api_key="YOUR_GEMINI_KEY"
firebase deploy --only functions
```

### Issue: Scheduler not found
**Solution:**
- The scheduler is created automatically when you deploy the scheduled function
- If missing, redeploy: `firebase deploy --only functions:monitorNewsForAlerts`

### Issue: Alerts not appearing
**Possible causes:**
1. No recent Malaysian news matching query
2. AI determined articles don't need alerts (`shouldCreateAlert: false`)
3. Duplicate prevention is working (similar alert exists)
4. NewsAPI quota exceeded

**Check logs** to see which case it is.

---

## üìä Expected Behavior

**If working correctly, you should see:**

1. **Every 15 minutes:**
   - Function executes automatically
   - Logs show "Fetching Malaysian news"
   - Logs show "Analyzing article" (if news found)
   - New alerts appear in Firestore (if relevant news found)

2. **In Firestore:**
   - Alerts with varied timestamps
   - Different regions and types
   - Natural language titles

3. **In App:**
   - Alerts screen updates automatically (StreamBuilder)
   - Recent timestamps shown
   - Alerts expire after 7 days

---

## üî¨ Advanced Verification: Check AI Decision Making

To verify AI is actually making decisions:

1. **Check Logs for Analysis:**
   - Look for logs showing article analysis
   - Should see JSON responses from Gemini
   - Should see "shouldCreateAlert: true/false"

2. **Test with Known News:**
   - Find a recent Malaysian flood/disaster news article
   - Manually trigger function
   - Check if alert is created for that article

3. **Check Duplicate Prevention:**
   - Create an alert manually
   - Trigger function again
   - Should see "Duplicate alert exists, skipping" in logs

---

## ‚úÖ Final Verification Checklist

- [ ] Function is deployed (`monitorNewsForAlerts`)
- [ ] Cloud Scheduler is enabled and running
- [ ] Function logs show recent executions (within last hour)
- [ ] Logs show "Analyzing article" (Gemini is working)
- [ ] Firestore `alerts` collection has recent alerts
- [ ] Alert timestamps are varied (not all same time)
- [ ] NewsAPI is returning articles (check quota)
- [ ] Gemini API is being called (check usage)
- [ ] App shows alerts with recent timestamps
- [ ] Manually triggering creates new alerts

**If all checked ‚úÖ**: Your AI alerts are **100% legit** and running in real-time!

---

## üé• Demo Script for Hackathon

**To demonstrate real-time AI alerts:**

1. **Show Cloud Scheduler**: "This runs every 15 minutes automatically"
2. **Show Function Logs**: "See here - AI is analyzing news articles right now"
3. **Show Firestore**: "Alerts are being created in real-time"
4. **Show App**: "Users see alerts immediately via StreamBuilder"
5. **Manually Trigger**: "Let me trigger it now to show you..." (Run Now)
6. **Wait 30 seconds**: "Watch the logs..."
7. **Show New Alert**: "And here's the new alert created by AI!"

This proves it's not static data - it's **real-time AI processing**.
